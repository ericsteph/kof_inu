tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.04 <- crea.blocco(99:113, x2)
blocco.04 <- flex_rmd1(z, 2L, "04")
blocco.04 <- flex_blocchi(chunk02.04, blocco.04)
vars.x = vars.q1[5]
capitolo.x <- capitoli[2]
riferimento.x <- riferimenti[5]
domanda.x <- capitoli_[6]
ris.x <- risposte00[2, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.05 <- crea.blocco(119:134, x2)
blocco.05 <- flex_rmd1(z, 2L, "05")
blocco.05 <- flex_blocchi(chunk02.05, blocco.05)
vars.x = vars.q1[6]
capitolo.x <- capitoli[5]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.06 <- crea.blocco(140:152, x2)
blocco.06 <- flex_rmd1(z, 2L, "06")
blocco.06 <- flex_blocchi(chunk02.06, blocco.06)
vars.x = vars.q1[7]
capitolo.x <- capitoli[6]
riferimento.x <- riferimenti[1]
ris.x <- risposte00[6, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.07 <- crea.blocco(158:172, x2)
blocco.07 <- flex_rmd1(z, 2L, "07")
blocco.07 <- flex_blocchi(chunk02.07, blocco.07)
vars.x = vars.q1[8]
capitolo.x <- capitoli[7]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.07b <- crea.blocco(178:190, x2)
blocco.07b <- flex_rmd1(z, 2L, "07b")
blocco.07b <- flex_blocchi(chunk02.07b, blocco.07b)
vars.x = vars.q1[9]
capitolo.x <- capitoli[9]
ris.x <- risposte03[1, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.07c <- crea.blocco(196:209, x2)
blocco.07c <- flex_rmd1(z, 2L, "07c")
blocco.07c <- flex_blocchi(chunk02.07c, blocco.07c)
vars.x = vars.q2[1]
capitolo.x <- capitoli[13]
riferimento.x <- riferimenti[2]
domanda.x <- capitoli_[2]
ris.x <- risposte01[2, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.08 <- crea.blocco(215:230, x2)
blocco.08 <- flex_rmd1(z, 1L, "08")
blocco.08 <- flex_blocchi(chunk02.08, blocco.08)
vars.x = vars.q2[2]
capitolo.x <- capitoli[10]
ris.x <- risposte03[5, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.09 <- crea.blocco(236:249, x2)
blocco.09 <- flex_rmd1(z, 2L, "09")
blocco.09 <- flex_blocchi(chunk02.09, blocco.09)
vars.x = vars.q2[3]
capitolo.x <- capitoli[14]
ris.x <- risposte01[2, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.10 <- crea.blocco(255:268, x2)
blocco.10 <- flex_rmd1(z, 2L, "10")
blocco.10 <- flex_blocchi(chunk02.10, blocco.10)
vars.x = vars.q2[4]
capitolo.x <- capitoli[15]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.11 <- crea.blocco(274:286, x2)
blocco.11 <- flex_rmd1(z, 2L, "11")
blocco.11 <- flex_blocchi(chunk02.11, blocco.11)
### 3.12
# Posizione concorrenziale (all'esterno dell'UE), ultimi tre mesi
vars.x = vars.q2[5]
capitolo.x <- capitoli[16]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.12 <- crea.blocco(292:304, x2)
blocco.12 <- flex_rmd1(z, 2L, "12")
blocco.12 <- flex_blocchi(chunk02.12, blocco.12)
vars.x = vars.q2[6]
capitolo.x <- capitoli[9]
ris.x <- risposte03[6, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.14 <- crea.blocco(310:323, x2)
blocco.14 <- flex_rmd1(z, 2L, "14")
blocco.14 <- flex_blocchi(chunk02.14, blocco.14)
### 3.15
# Situazione degli affari, prossimi sei mesi
vars.x = vars.q3[1]
capitolo.x <- capitoli[1]
domanda.x <- capitoli_[3]
riferimento.x <- riferimenti[4]
ris.x <- risposte01[6, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.15 <- crea.blocco(329:344, x2)
blocco.15 <- flex_rmd1(z, 1L, "15")
blocco.15 <- flex_blocchi(chunk02.15, blocco.15)
vars.x = vars.q3[2]
capitolo.x <- capitoli[3]
riferimento.x <- riferimenti[3]
ris.x <- risposte02[3, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.16 <- crea.blocco(350:364, x2)
blocco.16 <- flex_rmd1(z, 2L, "16")
blocco.16 <- flex_blocchi(chunk02.16, blocco.16)
### 3.17
# Volume degli ordini dall'estero, prossimi tre mesi
vars.x = vars.q3[3]
capitolo.x <- capitoli[4]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.17 <- crea.blocco(370:382, x2)
blocco.17 <- flex_rmd1(z, 2L, "17")
blocco.17 <- flex_blocchi(chunk02.17, blocco.17)
vars.x = vars.q3[4]
capitolo.x <- capitoli[8]
domanda.x <- capitoli_[5]
ris.x <- risposte02[3, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.18 <- crea.blocco(388:402, x2)
blocco.18 <- flex_rmd1(z, 2L, "18")
blocco.18 <- flex_blocchi(chunk02.18, blocco.18)
### 3.19
# Produzione, prossimi tre mesi
vars.x = vars.q3[5]
capitolo.x <- capitoli[5]
domanda.x <- capitoli_[3]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.19 <- crea.blocco(408:421, x2)
blocco.19 <- flex_rmd1(z, 2L, "19")
blocco.19 <- flex_blocchi(chunk02.19, blocco.19)
vars.x = vars.q3[6]
capitolo.x <- capitoli[12]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.20 <- crea.blocco(427:439, x2)
blocco.20 <- flex_rmd1(z, 2L, "20")
blocco.20 <- flex_blocchi(chunk02.20, blocco.20)
### 3.21
# Prezzi di vendita, prossimi tre mesi
vars.x = vars.q3[7]
capitolo.x <- capitoli[10]
ris.x <- risposte03[8, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.21 <- crea.blocco(445:458, x2)
blocco.21 <- flex_rmd1(z, 2L, "21")
blocco.21 <- flex_blocchi(chunk02.21, blocco.21)
vars.x = vars.q3[7]
capitolo.x <- capitoli[11]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.22 <- crea.blocco(464:476, x2)
blocco.22 <- flex_rmd1(z, 2L, "22")
blocco.22 <- flex_blocchi(chunk02.22, blocco.22)
### 3.23
# Acqusizione di ordini, sit.attuale vs. mese precedente
vars.x = vars.q4[1]
riferimento.x <- riferimenti[6]
capitolo.x <- capitoli[2]
domanda.x <- capitoli_[2]
ris.x <- risposte00[2, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.23 <- crea.blocco(482:497, x2)
blocco.23 <- flex_rmd1(z, 1L, "23")
blocco.23 <- flex_blocchi(chunk02.23, blocco.23)
vars.x = vars.q4[2]
capitolo.x <- capitoli[3]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.24 <- crea.blocco(503:515, x2)
blocco.24 <- flex_rmd1(z, 2L, "24")
blocco.24 <- flex_blocchi(chunk02.24, blocco.24)
### 3.25
# Produzione, sit.attuale  vs. mese precedente
vars.x = vars.q4[3]
capitolo.x <- capitoli[5]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.25 <- crea.blocco(521:533, x2)
blocco.25 <- flex_rmd1(z, 2L, "25")
blocco.25 <- flex_blocchi(chunk02.25, blocco.25)
vars.x = vars.q4[4]
capitolo.x <- capitoli[6]
ris.x <- risposte03[4, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.26 <- crea.blocco(539:552, x2)
blocco.26 <- flex_rmd1(z, 2L, "26")
blocco.26 <- flex_blocchi(chunk02.26, blocco.26)
### 3.27
# Stock prodotti intermedi, sit.attuale vs. mese precedente
vars.x = vars.q4[5]
capitolo.x <- capitoli[7]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex2(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.27 <- crea.blocco(558:570, x2)
blocco.27 <- flex_rmd1(z, 2L, "27")
blocco.27 <- flex_blocchi(chunk02.27, blocco.27)
vars.x = vars.q1[10]
riferimento.x <- riferimenti[1]
capitolo.x <- capitoli[17]
domanda.x <- capitoli_[7]
ris.x <- risposte00[1, ]
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
chunk02.00 <- crea.blocco(576:591, x2)
blocco.00 <- flex_rmd1(z, 1L, "00")
blocco.00 <- flex_blocchi(chunk02.00, blocco.00)
tmp <- dati_kof_trim(d, vars.x, vars.dove.x, vars.settore.x)
vars.x
vars.dove.x
vars.settore.x
vars2 <- paste0(vars.dove.x, paste0(vars.settore.x, vars.x))
vars2 <- sel.kof.vars(inchiesta, vars2)
vars2
d$anno <- as.integer(d$anno)
d1 <- d %>% dplyr::filter(anno >= primo_anno)
d1 <- d1 %>% dplyr::filter(series %in% vars2
)
head(d1)
d1 <- d1 %>% dplyr::filter(series %in% vars2,
periodo %in% c("01", "04", "07", "10"))
d1$anno <- factor(d1$anno, levels = c(primo_anno:ultimo_anno))
d1$periodo <- factor(d1$periodo, levels = c("01", "04", "07", "10"))
levels(d1$periodo) <- c("gennaio", "aprile", "luglio", "ottobre")
d1$value <- round(d1$value, digits = 1L)
d_cast <- d1 %>%
dcast( interaction(periodo, anno, sep = " ") ~ series , value.var = "value" )
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
testi <- c(riferimento.x, paste0(sotto.cap.x, ", ", dove.x), capitolo.x, riferimento.x)
testi
tmp <- dati_kof(d, vars.x, vars.dove.x, vars.settore.x)
vars2 <- paste0(vars.dove.x, paste0(vars.settore.x, vars.x))
vars2 <- sel.kof.vars(inchiesta, vars2)
d$anno <- as.integer(d$anno)
d1 <- d %>% dplyr::filter(anno >= primo_anno)
d1 <- d1 %>% dplyr::filter(series %in% vars2,
periodo %in% c("01", "04", "07", "10"))
d1$anno <- factor(d1$anno, levels = c(primo_anno:ultimo_anno))
d1$periodo <- factor(d1$periodo, levels = c("01", "04", "07", "10"))
levels(d1$periodo) <- c("gennaio", "aprile", "luglio", "ottobre")
str(d1)
d1$value <- round(d1$value, digits = 1L)
str(d1)
d_cast <- d1 %>%
dcast( interaction(periodo, anno, sep = " ") ~ series , value.var = "value" )
str(d_cast)
View(d_cast)
View(d1)
prova <- (d_cast, "", "")
prova <- c(d_cast, "", "")
head(prova)
dati_kof_SINT <- function(d, vars.x, vars.dove.x, vars.settore.x
# , n
)
{
vars2 <- paste0(vars.dove.x, paste0(vars.settore.x, vars.x))
vars2 <- sel.kof.vars(inchiesta, vars2)
d$anno <- as.integer(d$anno)
d1 <- d %>% dplyr::filter(anno >= primo_anno)
# k <- d$anno >= primo_anno
# d <- d[k, ]
d1 <- d1 %>% dplyr::filter(series %in% vars2,
periodo %in% c("01", "04", "07", "10"))
# d <- d[d$series %in% vars & d$periodo %in% c("01", "04", "07", "10"), ]
d1$anno <- factor(d1$anno, levels = c(primo_anno:ultimo_anno))
d1$periodo <- factor(d1$periodo, levels = c("01", "04", "07", "10"))
levels(d1$periodo) <- c("gennaio", "aprile", "luglio", "ottobre")
d1$value <- round(d1$value, digits = 1L)
d_cast <- d1 %>%
dcast( interaction(periodo, anno, sep = " ") ~ series , value.var = "value" )
# d_cast <- d_cast[(nrow(d_cast) - n):nrow(d_cast),]
colnames(d_cast) <- c("Inchiesta", "Balance")
d_cast
}
tmp <- dati_kof_SINT(d, vars.x, vars.dove.x, vars.settore.x)
z <- genera_flex(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
prova <- dati.tndz(tmp, tmp[, 2])
head(prova)
crea.tabella_SINT <-   function(d, titolo, dom.ris){
k <- nrow(d)
colnames(d) <- c("Inchiesta", "Balance", "Var.bal.3m",
"var1.x", "Var.bal.12m", "var2.x", "Media.bal", "vs.t0")
d <-   d %>% dplyr::select(Inchiesta, Balance,
Media.bal, vs.t0, Var.bal.3m, Var.bal.12m)
d <- formattable::format_table(
d,
digits = 1L,
align = c("l", "c", "r", "l", "c","l", rep("c", 2)),
format = "html",
caption = titolo,
row_label_position = "l",
formatters = list(
Balance = color_tile("white", color3[5]
),
Media.bal = color_tile("white", grigi[5]
),
vs.t0 = formatter(
"span",
style = x ~ style(color = ifelse(x,  "", grigi[5])),
x ~ icontext(ifelse(x, "", "thumbs-down"), ifelse(x, "", ""))
),
Var.bal.3m = formatter(
"span", style = x ~ style(color = ifelse(rank(-x, ties.method = "max") <= 2, color3[11],
ifelse(rank(-x, ties.method = "max") > k -2, color3[1], grigi[4]))),
x ~ sprintf("%.1f (rank: %02d)", x, rank(-x, ties.method = "max")),
x ~ icontext(ifelse(x > 5, "arrow-up",
ifelse(x < -5, "arrow-down", "")))
),
Var.bal.12m = formatter(
"span", style = x ~ style(color = ifelse(rank(-x, ties.method = "max") <= 2, color3[11],
ifelse(rank(-x, ties.method = "max") > k -2, color3[1], grigi[4]))),
x ~ sprintf("%.1f (rank: %02d)", x, rank(-x, ties.method = "max")),
x ~ icontext(ifelse(x > 5, "arrow-up",
ifelse(x < -5, "arrow-down", "")))
)
)) %>%
kable_styling("hover", full_width = F, position = "left") %>%
row_spec(0, bold = F) %>%
add_header_above(header = c("Indicatori classici" = 2, "Nuovi indicatori" = 4)) %>%
# group_rows("2019", 12, 13) %>% # Come align : "links"
column_spec(1, width = "4cm") %>%
column_spec(2, bold = T, width = "2.5cm") %>%
column_spec(3, width = "1.5cm") %>%
column_spec(4, width = "0.5cm") %>%
footnote(
alphabet = c(
"Media.bal: Media dell'INDICATORE SINTETICO nelle ultime quattro inchieste",
"vs.t0: Valore dell'INDICATORE SINTETICO nell'ultima inchiesta rispetto alla media",
"Var.bal.3m: Valore dell'INDICATORE SINTETICO rispetto all'inchieste precedente",
"Var.bal.12m: Valore dell'INDICATORE SINTETICO rispetto all'inchiesta nello stesso periodo un anno prima"),
number_title = "Indicatori classici",
alphabet_title = "Nuovi indicatori"
)
d
}
out.tabella_SINT <- function(d1, domanda, dove, dom.ris){
d2 <- dati.tndz(d1, d1[, 2])
titolo <- paste0(domanda, dove, ", da ", d2[1, 1], " a ", d2[nrow(d2), 1])
tmp <- crea.tabella_SINT(d2, titolo, dom.ris)
tmp
}
out.grafici_SINT <- function(d1, domanda, dove){
titolo1 <- "Indicatore SINTETICO"
sottotitolo <- paste0(domanda, dove)
p1 <- crea.gauge.balance(d1, titolo1, sottotitolo)
p1 <- p1 + tema1  + guides(fill = guide_legend(title.position = "left", label.position = "top"))
p2 <- ""
p3 <- ""
p <- list(p1, p2, p3)
}
genera_flex_SINT <- function(
d, inchiesta,
vars.x,
dove.x, vars.dove.x , capitolo.x,
domanda.x, riferimento.x,
sotto.cap.x, ris.x, testi){
dom.ris_f <- crea.dom.ris(sotto.cap.x, domanda.x, ris.x)
titolo.x <- c(paste0(capitolo.x, " (", tolower(domanda.x),
ifelse(riferimento.x == "Situazione attuale", " della ",
ifelse(riferimento.x == "Ultimi tre mesi", " degli ", " ")),
tolower(riferimento.x),"), "))
storyboard.Title1 <- Titolo1(testi[1])
storyboard.Title2 <- Titolo2(testi[2], testi[3], testi[4], vars.x)
storyboard.cambio <- Cambio.s(ultimo_mese, ultimo_anno, dove.x)
# Tabella
t <- out.tabella_SINT(d, titolo.x, dove.x, dom.ris_f)
# Grafici
p <- out.grafici_SINT(d, titolo.x, dove.x)
table <- crea.tbl(capitolo.x, riferimento.x, sotto.cap.x, domanda.x, ris.x)
output <- list(storyboard.Title1 = storyboard.Title1,
storyboard.Title2 = storyboard.Title2,
storyboard.cambio = storyboard.cambio,
t = t,
table = table,
p = p)
output
}
z <- genera_flex_SINT(tmp, inchiesta, vars.x, dove.x, vars.dove.x, capitolo.x,
domanda.x, riferimento.x, sotto.cap.x, ris.x, testi)
z$storyboard.Title1
z$storyboard.Title2
z$t
chunk02.00 <- crea.blocco(576:591, x2)
blocco.00 <- flex_rmd1(z, 1L, "00")
blocco.00 <- flex_blocchi(chunk02.00, blocco.00)
rm(list=ls())
# source("000_pacchetti.R", encoding = "UTF-8")
# source("00_FUNZIONI_dashboard.R", encoding = "UTF-8")
# source("00_FUNZIONI_x_figure_occupazione_attuale.R", encoding = "UTF-8")
# source("00_FUNZIONI_genera.R", encoding = "UTF-8")
source("01_inu_variabili.R", encoding = "UTF-8")
# source("02_FUNZ_buildup_Rmd_bau_x_regione.R", encoding = "UTF-8")
source("02_FUNZ_buildup_Rmd_inu.R", encoding = "UTF-8")
tmp <- "title: \"KOF, inchiesta congiunturale, INDUSTRIA (inu) | "
tmp2 <- "inu_flexdashboard."
# Creo un file .Rmd per il settore industriale, in Ticino
vars.settore.x <- vars.settore[1]
sotto.cap.x<- settori[1]
dove.x <- dove[1]
vars.dove.x <- vars.dove[1]
chunk02.x <- readLines(con = '03_inu_crea_Rmd.R', warn = FALSE)[14:20]
titolo_princ <- paste0(tmp, paste0(sotto.cap.x, ", ", dove.x), "\"")
nome_file <- paste0(tmp2, paste0(vars.dove.x, vars.settore.x), "Rmd")
crea.Rmd.inu(titolo_princ, chunk02.x, vars.settore.x, sotto.cap.x, dove.x, vars.dove.x, nome_file)
rm(list=ls())
# source("000_pacchetti.R", encoding = "UTF-8")
# source("00_FUNZIONI_dashboard.R", encoding = "UTF-8")
# source("00_FUNZIONI_x_figure_occupazione_attuale.R", encoding = "UTF-8")
# source("00_FUNZIONI_genera.R", encoding = "UTF-8")
source("01_inu_variabili.R", encoding = "UTF-8")
# source("02_FUNZ_buildup_Rmd_bau_x_regione.R", encoding = "UTF-8")
source("02_FUNZ_buildup_Rmd_inu.R", encoding = "UTF-8")
tmp <- "title: \"KOF, inchiesta congiunturale, INDUSTRIA (inu) | "
tmp2 <- "inu_flexdashboard."
# Creo un file .Rmd per il settore industriale, in Ticino
vars.settore.x <- vars.settore[1]
sotto.cap.x<- settori[1]
dove.x <- dove[1]
vars.dove.x <- vars.dove[1]
chunk02.x <- readLines(con = '03_inu_crea_Rmd.R', warn = FALSE)[14:20]
titolo_princ <- paste0(tmp, paste0(sotto.cap.x, ", ", dove.x), "\"")
nome_file <- paste0(tmp2, paste0(vars.dove.x, vars.settore.x), "Rmd")
crea.Rmd.inu(titolo_princ, chunk02.x, vars.settore.x, sotto.cap.x, dove.x, vars.dove.x, nome_file)
# Creo un file .Rmd per il settore industriale, industria interna (0-33%) in Ticino
vars.settore.x <- vars.settore[2]
sotto.cap.x<- settori[2]
dove.x <- dove[1]
vars.dove.x <- vars.dove[1]
chunk02.x <- readLines(con = '03_inu_crea_Rmd.R', warn = FALSE)[27:33]
titolo_princ <- paste0(tmp, paste0(sotto.cap.x, ", ", dove.x), "\"")
nome_file <- paste0(tmp2, paste0(vars.dove.x, vars.settore.x), "Rmd")
crea.Rmd.inu(titolo_princ, chunk02.x, vars.settore.x, sotto.cap.x, dove.x, vars.dove.x, nome_file)
# Creo un file .Rmd per il settore industriale, industria interna (66-100%) in Ticino
vars.settore.x <- vars.settore[3]
sotto.cap.x<- settori[3]
dove.x <- dove[1]
vars.dove.x <- vars.dove[1]
chunk02.x <- readLines(con = '03_inu_crea_Rmd.R', warn = FALSE)[40:46]
titolo_princ <- paste0(tmp, paste0(sotto.cap.x, ", ", dove.x), "\"")
nome_file <- paste0(tmp2, paste0(vars.dove.x, vars.settore.x), "Rmd")
crea.Rmd.inu(titolo_princ, chunk02.x, vars.settore.x, sotto.cap.x, dove.x, vars.dove.x, nome_file)
install.packages("prettydoc")
library(prettydoc)
